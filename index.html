<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Chat program</title>
        <meta charset="UTF-8">
        

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <link rel="stylesheet" type="text/css" 
            href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		
        <link rel="stylesheet" type="text/css" href="style.css">
        <style>
            #nameForm {
                margin-top: 50px;
            }
            #setDataButton {
                margin-top: 40px;
                width: 60%;
                font-size: 24px;
            }
			#usernameInUseMessageBox {
				margin-top: 20px;
				display: none;
				margin-left: 20%;
                width: 60%;
			}
		</style>
	</head>
	<body>
        <h1>Enter your name:</h1>
        <input type="text" id="nameEntry" name="username">
		<!--
        <h1>Pick a color:</h1>
        <select name="nameColor">
            <option value="black">Black</option>
            <option value="pink">Pink</option>
            <option value="red">Red</option>
            <option value="green">Green</option>
            <option value="blue">Blue</option>
            <option value="purple">Purple</option>
            <option value="orange">Orange</option>
            <option value="yellow">Yellow</option>
        </select>
		-->
        <br />
        <button type="submit" id="setDataButton">Set Name</button>
		<div id="usernameInUseMessageBox" class="alert alert-danger" role="alert">
			Username is in use
		</div>
    </body>
	<script src="cookieInterface.js"></script>
    <script>
		var username = "";
		var usernameInUse = false;
		var queryNameListRequest;
		function queryNameList() {
			queryNameListRequest = new XMLHttpRequest();
			queryNameListRequest.onreadystatechange = updateNameListCallback;
			queryNameListRequest.open("POST", "nameQuery.php", true);
			queryNameListRequest.send();
		}
		function updateNameListCallback(){
			if ((queryNameListRequest.readyState == 4) && (queryNameListRequest.status == 200)) {
				var response = queryNameListRequest.responseText;
				var names = JSON.parse(response);
				// For each name
				var foundUsername = false;
				for(var i = 0; i < names.length; i++){
					if(username == names[i]) {
						foundUsername = true;
						break;
					}
				}
				if(foundUsername){
					$('#usernameInUseMessageBox').show();
					usernameInUse = true;
				} else {
					$('#usernameInUseMessageBox').hide();
					usernameInUse = false;
				}
			}
		}
		function enterName () {
			if(!usernameInUse && username.length > 0) {
				setCookie("username", username);
				window.location.replace("chat.html");
			}
		}
		$(document).ready(function(){
			$('#usernameInUseMessageBox').hide();
			$("#nameEntry").keyup(function(){
				username = document.getElementById("nameEntry").value;
				queryNameList();
			});
			$("#nameEntry").keypress(function(e){
  				if(e.keyCode == 13){
					enterName();
				}
			});
			$("#setDataButton").click(enterName);
		});
    </script>
</html>
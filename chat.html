<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Chat program</title>
		<meta charset="UTF-8">
		
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">
        <link rel="stylesheet" type="text/css" 
            href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		
        <link rel="stylesheet" type="text/css" href="style.css">
		<style>
			.dataList {
				text-align: left;
				border: 2px solid black;
				border-radius: 20px;
				width: 90%;
				height: 500px;
				overflow-y: auto;
				overflow-x: hidden;
				padding: 10px;
				margin: 10px auto;
			}
			#nameList {
			}
			#chatDisplay {
			}
			#messageEntry {
				width: 90%;
				margin: 10px auto;
			}
		</style>
	</head>
	<body>
		<section class="container">
			<section class="row" style="text-align: center;">
				<h1>Chat</h1>
			</section>
			<section class="row">
				<div class="col-md-5 col-sm-12">
					<div id="nameList" class="dataList"></div>
				</div>
				<div class="col-md-7 col-sm-12">
					<div id="chatDisplay" class="dataList"></div>
					<input type="text" id="messageEntry" placeholder="Type message here">
					<button id="chatButton">Send message</button>
				</div>
			</section>
		</section>
		<footer>
			<a href="https://github.com/PyCee/chat" target="_blank"><i class="fab fa-github"></i></a>
		</footer>
	</body>
	

	<script src="cookieInterface.js" charset="utf-8"></script>
	<script src="ajaxInterface.js" charset="utf-8"></script>
	<script>
		var sendRequest;
		var updateChatRequest;
		var updateNameListRequest;
		var lastTimestamp = "99999999";
		var currentNameList = [];
		var username = getCookie("username");
		if(username == null || username.length == 0){
			var alertString = "username is null or username.length is 0: ";
			//alert(alertString + "'" + username + "'");
			window.location.replace("index.html");
		} else {
			setCookie("username", "");
			addSelfToNameList();
		}
		
		
		// jquery to run function on button press
		setInterval(checkForNewMessage, 200);
		updateNameList();
		setInterval(updateNameList, 1000);

		$(document).ready(function(){
			
			$("#chatButton").click(function(){
				sendMessage();
			});
			$("#messageEntry").keypress(function(e){
  				if(e.keyCode == 13){
					sendMessage();
				}
			});
			window.onbeforeunload = function(e){
				removeSelfFromNameList();
			};
		});
	</script>
</html>